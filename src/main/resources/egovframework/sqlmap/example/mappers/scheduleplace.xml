<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ants.com.board.memBoard.mapper.memBoardMapper">
	
	<!-- 일정 등록 -->
	<insert id="scheduleInsert" parameterType="ants.com.board.memBoard.model.ScheduleVo">
		INSERT INTO SCHEDULE VALUES(SCHE_SEQ.NEXTVAL, #{scheTitle}, #{scheCont}, SYSDATE, #{xVal}, #{yVal}, #{categoryId}, #{reqId}, 
									#{memId}, #{del}, #{startDt}, #{endDt}, #{juso}, null)
	</insert>
	
	
	<!-- 일정 리스트 -->
	<select id="schedulelist" parameterType="ants.com.board.memBoard.model.ScheduleVo" resultType="ants.com.board.memBoard.model.ScheduleVo">
		SELECT c.*
		  FROM (
		   SELECT ROWNUM rnum, a.* 
			 FROM (
			     SELECT SCHE_ID, SCHE_TITLE, SCHE_CONT, to_char(REG_DT,'YYYY-MM-DD hh:mm') as REG_DT, X_VAL, Y_VAL, CATEGORY_ID, REQ_ID, MEM_ID, DEL, START_DT, END_DT, JUSO, CALENDARCSS
			     FROM SCHEDULE
			     WHERE category_id = #{categoryId} AND
				 req_id = #{reqId} AND
				 del = 'N'
			     ORDER BY REG_DT DESC) a
		WHERE ROWNUM  <![CDATA[ <= ]]> #{lastIndex}) c <![CDATA[WHERE rnum > #{firstIndex}]]>
	</select>
	
	
	<!-- 일정 갯수  -->
	<select id="schedulelistCount" parameterType="ants.com.board.memBoard.model.ScheduleVo" resultType="int">
		SELECT COUNT(*)
		  FROM SCHEDULE
		 WHERE category_id = #{categoryId} AND
		 req_id = #{reqId} AND
		 del = 'N'
	</select>
	
	
	<!-- 일정 상세페이지 -->
	<select id="scheduleSelect" parameterType="ants.com.board.memBoard.model.ScheduleVo" resultType="ants.com.board.memBoard.model.ScheduleVo">
		SELECT SCHE_ID, SCHE_TITLE, SCHE_CONT, to_char(REG_DT,'YYYY-MM-DD hh:mm') as REG_DT, X_VAL, Y_VAL, CATEGORY_ID, REQ_ID, MEM_ID, DEL, to_char(START_DT,'YYYY-MM-DD') as START_DT, to_char(END_DT,'YYYY-MM-DD') as END_DT, JUSO, CALENDARCSS
		  FROM SCHEDULE
		 WHERE sche_id = #{scheId}
	</select>
	
	
	<!-- 일정 수정하기 -->
	<update id="scheduleUpdate" parameterType="ants.com.board.memBoard.model.ScheduleVo">
		UPDATE SCHEDULE
		SET SCHE_TITLE = #{scheTitle},
			SCHE_CONT = #{scheCont},
			X_VAL = #{xVal},
			Y_VAL = #{yVal},
			START_DT = #{startDt},
			END_DT = #{endDt},
			JUSO = #{juso}
		WHERE 
	    	sche_id = #{scheId}
	</update>
	
	
	<!-- 일정 삭제하기 -->
	<update id="scheduleDelete" parameterType="ants.com.board.memBoard.model.ScheduleVo"> 
		UPDATE SCHEDULE 
			set del = 'Y' 
		WHERE sche_id = #{scheId}
	</update>
	
	<!-- 일정 리스트(캘린더용) -->
	<select id="showCalendar" parameterType="ants.com.board.memBoard.model.ScheduleVo" resultType="ants.com.board.memBoard.model.ScheduleVo">
		SELECT SCHE_ID, SCHE_TITLE, SCHE_CONT, to_char(REG_DT,'YYYY-MM-DD') as REG_DT, X_VAL, Y_VAL, CATEGORY_ID, REQ_ID, MEM_ID, DEL, START_DT, END_DT, JUSO, CALENDARCSS
			FROM SCHEDULE
			WHERE req_id = #{reqId} 
			AND	 del = 'N'
	</select>
	
	<!-- 일정 등록 (캘린더용)-->
	<insert id="calendarInsert" parameterType="ants.com.board.memBoard.model.ScheduleVo">
		INSERT INTO SCHEDULE 
			VALUES(
				SCHE_SEQ.NEXTVAL, 
				#{scheTitle}, 
				#{scheCont}, 
				TO_DATE(SYSDATE,'YYYY/MM/DD'), 
				NULL, NULL, 
				'6', 
				#{reqId}, 
				#{memId},
				'N', 
				#{startDt},
				<if test="endDt != null">
				#{endDt}, 
				NULL,
				#{calendarcss})
				</if>
				<if test="endDt == null">
				NULL, 
				NULL,
				#{calendarcss})
				</if>
	</insert>
	
	<!-- 일정 수정하기 (캘린더용)-->
	<update id="calendarUpdate" parameterType="ants.com.board.memBoard.model.ScheduleVo">
		UPDATE SCHEDULE
		SET SCHE_TITLE = #{scheTitle},
			SCHE_CONT = #{scheCont},
			START_DT = #{startDt},
			<if test="endDt != null">
			END_DT = #{endDt}
			</if>
			<if test="endDt == null">
			END_DT = NULL
			</if>
		WHERE 
	    	sche_id = #{scheId}
	</update>
	
	
	<!-- 일정 상세페이지 (캘린더용)-->
	<select id="getscheduleDetail" parameterType="ants.com.board.memBoard.model.ScheduleVo" resultType="ants.com.board.memBoard.model.ScheduleVo">
		SELECT SCHE_ID, SCHE_TITLE, SCHE_CONT, to_char(REG_DT,'YYYY-MM-DD') as REG_DT, X_VAL, Y_VAL, CATEGORY_ID, REQ_ID, MEM_ID, DEL, to_char(START_DT,'YYYY-MM-DD') as START_DT, to_char(END_DT,'YYYY-MM-DD') as END_DT, JUSO, CALENDARCSS
		  FROM SCHEDULE
		 WHERE sche_id = #{scheId}
	</select>
	 
</mapper>