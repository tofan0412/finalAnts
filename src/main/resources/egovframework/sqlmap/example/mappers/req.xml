<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ants.com.member.mapper.ReqMapper">
	
	<!-- 요구사항정의서 목록가져오기 -->
	<select id="reqList" parameterType="ants.com.member.model.ReqVo"
		resultType="ants.com.member.model.ReqVo">
	     <![CDATA[
	    SELECT  *
		    FROM(
		    	SELECT ROWNUM rnum, a.*
				FROM (SELECT b.*
                        FROM reqlist b
                        WHERE mem_id = #{memId}
                        ORDER BY TO_NUMBER(b.REQ_ID)DESC) a
                WHERE rownum <= #{lastIndex})
            WHERE rnum > #{firstIndex} 
             ]]>
	</select>
	
	<!-- 페이지처리위한 요구사항개수 -->
	<select id="reqListCount" parameterType="String"
		resultType="java.lang.Integer">
		<![CDATA[
		    	SELECT COUNT(*)
				  FROM reqlist
				 WHERE mem_id = #{memId}
	    ]]>
	</select>
	
	<!-- 요구사항정의서 정보 가져오기 -->
	<select id="getReq" parameterType="ants.com.member.model.ReqVo" resultType="ants.com.member.model.ReqVo" >
		SELECT REQ_ID
			 , REQ_TITLE
			 , REQ_CONT
			 , REQ_PERIOD
			 , REQ_FILEPATH
			 , REQ_FILENAME
			 , MEM_ID
			 , STATUS
			 , PL_ID
		  FROM reqlist
		 WHERE req_id = #{reqId} 
	</select>

	<insert id="reqInsert"
		parameterType="ants.com.member.model.ReqVo">
		INSERT INTO REQLIST
			(REQ_ID
			 ,REQ_TITLE
			 ,REQ_CONT
			 ,REQ_PERIOD
			 ,REQ_FILEPATH
			 ,REQ_FILENAME
			 ,MEM_ID
			 ,STATUS
			 ,PL_ID)
		VALUES(REQ_SEQ.nextval
			 ,#{reqTitle}
			 ,#{reqCont}
			 ,#{reqPeriod}
			 ,#{reqFilepath, jdbcType=VARCHAR}
			 ,#{reqFilename, jdbcType=VARCHAR}
			 ,#{memId}
			 ,#{status, jdbcType=VARCHAR}
			 ,#{plId, jdbcType=VARCHAR})
	</insert>
	
	<update id="reqUpdate" parameterType="ants.com.member.model.ReqVo">
		UPDATE   reqlist
		 <set>
		        <if test="reqTitle != null">req_title = #{reqTitle},</if>
		        <if test="reqCont != null">req_cont = #{reqCont},</if>
		        <if test="reqPeriod != null">req_period = #{reqPeriod},</if>
		        <if test="reqFilepath != null">req_filepath = #{reqFilepath},</if>	 	            
		        <if test="reqFilename != null">req_filename = #{reqFilename}</if>	 	            
	     </set>    
		 WHERE   1=1
		   AND   req_id = #{reqId}
	</update>

	<delete id="reqDelete" parameterType="String">
		DELETE 
		  FROM reqlist
		 WHERE req_id = #{reqId} 
	</delete>
	
	<select id="getAllMember" resultType="ants.com.member.model.MemberVo">
		SELECT mem_id, mem_name, mem_tel, mem_filepath, mem_filename 
		  FROM member
		 WHERE UPPER(del) = 'N'
	</select>
	
</mapper>